"""技能别名系统"""

# 属性别名映射 -> 标准属性名
ATTRIBUTE_ALIASES = {
    # STR 力量
    "str": "STR", "力量": "STR", "力": "STR",
    # CON 体质
    "con": "CON", "体质": "CON", "体": "CON",
    # SIZ 体型
    "siz": "SIZ", "体型": "SIZ",
    # DEX 敏捷
    "dex": "DEX", "敏捷": "DEX", "敏": "DEX",
    # APP 外貌
    "app": "APP", "外貌": "APP", "外": "APP", "魅力": "APP",
    # INT 智力/灵感
    "int": "INT", "智力": "INT", "智": "INT", "灵感": "INT",
    # POW 意志
    "pow": "POW", "意志": "POW", "精神": "POW",
    # EDU 教育
    "edu": "EDU", "教育": "EDU", "知识": "EDU",
    # LUK 幸运
    "luk": "LUK", "luck": "LUK", "幸运": "LUK", "运气": "LUK",
}

# 技能别名映射 -> 标准技能名
SKILL_ALIASES = {
    # 侦查相关
    "侦查": "侦查", "检查": "侦查", "观察": "侦查", "搜索": "侦查",
    "spot": "侦查", "spot hidden": "侦查",
    # 聆听
    "聆听": "聆听", "倾听": "聆听", "听": "聆听", "listen": "聆听",
    # 图书馆使用
    "图书馆": "图书馆使用", "图书馆使用": "图书馆使用", "library": "图书馆使用",
    # 心理学
    "心理学": "心理学", "心理": "心理学", "psychology": "心理学",
    # 闪避
    "闪避": "闪避", "dodge": "闪避", "躲避": "闪避",
    # 潜行
    "潜行": "潜行", "隐匿": "潜行", "stealth": "潜行", "躲藏": "潜行",
    # 说服
    "说服": "说服", "劝说": "说服", "persuade": "说服",
    # 话术
    "话术": "话术", "快速交谈": "话术", "fast talk": "话术",
    # 魅惑
    "魅惑": "魅惑", "取悦": "魅惑", "charm": "魅惑",
    # 恐吓
    "恐吓": "恐吓", "威胁": "恐吓", "intimidate": "恐吓",
    # 急救
    "急救": "急救", "first aid": "急救",
    # 医学
    "医学": "医学", "medicine": "医学",
    # 汽车驾驶
    "驾驶": "汽车驾驶", "汽车驾驶": "汽车驾驶", "drive": "汽车驾驶", "开车": "汽车驾驶",
    # 电气维修
    "电气维修": "电气维修", "电工": "电气维修", "electrical": "电气维修",
    # 机械维修
    "机械维修": "机械维修", "机修": "机械维修", "mechanical": "机械维修",
    # 攀爬
    "攀爬": "攀爬", "climb": "攀爬", "爬": "攀爬",
    # 游泳
    "游泳": "游泳", "swim": "游泳",
    # 跳跃
    "跳跃": "跳跃", "jump": "跳跃", "跳": "跳跃",
    # 投掷
    "投掷": "投掷", "throw": "投掷",
    # 神秘学
    "神秘学": "神秘学", "occult": "神秘学",
    # 克苏鲁神话
    "克苏鲁神话": "克苏鲁神话", "cm": "克苏鲁神话", "cthulhu": "克苏鲁神话",
    # 计算机使用
    "计算机": "计算机使用", "计算机使用": "计算机使用", "电脑": "计算机使用", "computer": "计算机使用",
    # 电子学
    "电子学": "电子学", "电子": "电子学", "electronics": "电子学",
    # 操作重型机械
    "重型机械": "操作重型机械", "操作重型机械": "操作重型机械", "重机械": "操作重型机械",
    # 精神分析
    "精神分析": "精神分析", "psychoanalysis": "精神分析",
    # 博物学
    "博物学": "博物学", "自然学": "博物学", "natural history": "博物学",
    # 信用评级
    "信用": "信用评级", "信用评级": "信用评级", "credit": "信用评级",
    # 乔装
    "乔装": "乔装", "伪装": "乔装", "disguise": "乔装",
    # 导航
    "导航": "导航", "navigate": "导航",
    # 追踪
    "追踪": "追踪", "track": "追踪",
    # 锁匠
    "锁匠": "锁匠", "开锁": "锁匠", "locksmith": "锁匠",
    # 妙手
    "妙手": "妙手", "sleight": "妙手",
    # 骑术
    "骑术": "骑术", "骑马": "骑术", "ride": "骑术",
    # 会计
    "会计": "会计", "accounting": "会计",
    # 人类学
    "人类学": "人类学", "anthropology": "人类学",
    # 估价
    "估价": "估价", "appraise": "估价",
    # 考古学
    "考古学": "考古学", "考古": "考古学", "archaeology": "考古学",
    # 历史
    "历史": "历史", "history": "历史",
    # 法律
    "法律": "法律", "law": "法律",
    # 驯兽
    "驯兽": "驯兽", "驯服": "驯兽", "animal handling": "驯兽",
    # 潜水
    "潜水": "潜水", "diving": "潜水",
    # 爆破
    "爆破": "爆破", "demolitions": "爆破",
    # 读唇
    "读唇": "读唇", "lip reading": "读唇",
    # 催眠
    "催眠": "催眠", "hypnosis": "催眠",
    # 炮术
    "炮术": "炮术", "artillery": "炮术",
    
    # ===== 格斗技能 (数据库中存储为简单名称如"斗殴") =====
    "斗殴": "斗殴", "格斗": "斗殴", "肉搏": "斗殴", "brawl": "斗殴",
    "拳击": "斗殴", "徒手": "斗殴",
    "剑": "剑", "sword": "剑", "长剑": "剑", "短剑": "剑", "刀剑": "剑",
    "斧": "斧", "axe": "斧", "斧头": "斧", "战斧": "斧",
    "矛": "矛", "spear": "矛", "长矛": "矛",
    "鞭": "鞭", "whip": "鞭", "鞭子": "鞭",
    "绞索": "绞索", "garrote": "绞索",
    "链枷": "链枷", "flail": "链枷",
    "电锯": "电锯", "chainsaw": "电锯",

    # ===== 射击技能 =====
    "手枪": "手枪", "handgun": "手枪", "pistol": "手枪", "左轮": "手枪", "自动手枪": "手枪",
    "步枪/霰弹枪": "步枪/霰弹枪", "步枪": "步枪/霰弹枪", "rifle": "步枪/霰弹枪",
    "霰弹枪": "步枪/霰弹枪", "shotgun": "步枪/霰弹枪", "猎枪": "步枪/霰弹枪", "散弹枪": "步枪/霰弹枪",
    "冲锋枪": "冲锋枪", "smg": "冲锋枪", "submachine": "冲锋枪",
    "机枪": "机枪", "machine gun": "机枪", "重机枪": "机枪", "轻机枪": "机枪",
    "弓": "弓", "bow": "弓", "长弓": "弓", "短弓": "弓", "弓箭": "弓",
    "弩": "弩", "crossbow": "弩", "十字弓": "弩",
    "火焰喷射器": "火焰喷射器", "喷火器": "火焰喷射器",

    # ===== 科学技能 =====
    "生物学": "生物学", "biology": "生物学",
    "化学": "化学", "chemistry": "化学",
    "物理学": "物理学", "physics": "物理学", "物理": "物理学",
    "地质学": "地质学", "geology": "地质学",
    "天文学": "天文学", "astronomy": "天文学",
    "数学": "数学", "mathematics": "数学",
    "植物学": "植物学", "botany": "植物学",
    "动物学": "动物学", "zoology": "动物学",
    "气象学": "气象学", "meteorology": "气象学",
    "药学": "药学", "pharmacy": "药学",
    "法医学": "法医学", "forensics": "法医学",
    "密码学": "密码学", "cryptography": "密码学",

    # ===== 技艺技能 =====
    "摄影": "摄影", "photography": "摄影",
    "绘画": "绘画", "painting": "绘画",
    "雕塑": "雕塑", "sculpture": "雕塑",
    "表演": "表演", "acting": "表演",
    "唱歌": "唱歌", "singing": "唱歌", "歌唱": "唱歌",
    "舞蹈": "舞蹈", "dancing": "舞蹈", "跳舞": "舞蹈",
    "写作": "写作", "writing": "写作",
    "烹饪": "烹饪", "cooking": "烹饪", "做饭": "烹饪",
    "伪造": "伪造", "forgery": "伪造",

    # ===== 外语技能 =====
    "英语": "英语", "english": "英语",
    "日语": "日语", "japanese": "日语",
    "法语": "法语", "french": "法语",
    "德语": "德语", "german": "德语",
    "拉丁语": "拉丁语", "latin": "拉丁语",
    "俄语": "俄语", "russian": "俄语",
    "西班牙语": "西班牙语", "spanish": "西班牙语",
    "阿拉伯语": "阿拉伯语", "arabic": "阿拉伯语",
    "古希腊语": "古希腊语",

    # ===== 驾驶技能 =====
    "飞机": "飞机", "aircraft": "飞机", "开飞机": "飞机",
    "船": "船", "boat": "船", "开船": "船", "驾船": "船",
    "摩托车": "摩托车", "motorcycle": "摩托车", "摩托": "摩托车", "骑摩托": "摩托车",

    # ===== 生存技能 =====
    "沙漠": "沙漠", "沙漠生存": "沙漠",
    "海洋": "海洋", "海洋生存": "海洋",
    "极地": "极地", "极地生存": "极地",
    "山地": "山地", "山地生存": "山地",
    "森林": "森林", "森林生存": "森林",
    "丛林": "丛林", "丛林生存": "丛林",
}


class SkillResolver:
    """技能名称解析器"""

    def __init__(self):
        # 合并所有别名（小写化）
        self._aliases = {}
        for alias, standard in ATTRIBUTE_ALIASES.items():
            self._aliases[alias.lower()] = standard
        for alias, standard in SKILL_ALIASES.items():
            self._aliases[alias.lower()] = standard

    def resolve(self, name: str) -> str:
        """解析技能/属性名称，返回标准名称"""
        name_lower = name.lower().strip()

        # 先查别名表
        if name_lower in self._aliases:
            return self._aliases[name_lower]

        # 没找到就返回原名（可能是用户自定义技能）
        return name
    
    def is_attribute(self, name: str) -> bool:
        """判断是否为属性"""
        resolved = self.resolve(name)
        return resolved.upper() in ("STR", "CON", "SIZ", "DEX", "APP", "INT", "POW", "EDU", "LUK")
    
    def add_alias(self, alias: str, standard: str):
        """添加自定义别名"""
        self._aliases[alias.lower()] = standard


# 全局实例
skill_resolver = SkillResolver()
